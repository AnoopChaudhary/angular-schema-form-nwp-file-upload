/**
 * angular-schema-form-nwp-file-upload - Upload file type for Angular Schema Form
 * @version v0.1.0
 * @link https://github.com/saburab/angular-schema-form-nwp-file-upload
 * @license MIT
 */
"use strict";angular.module("schemaForm").config(["schemaFormProvider","schemaFormDecoratorsProvider","sfPathProvider",function(e,r,i){var a="Wrong file type. Allowed types are ",l="This file is too large. Maximum size allowed is ",n="Current file size:",t="You have to upload at least one file",s="You can't upload more than one file.",o=function(r,o,m){if("array"===o.type&&"singlefile"===o.format){o.pattern&&o.pattern.mimeType&&!o.pattern.validationMessage&&(o.pattern.validationMessage=a),o.maxSize&&o.maxSize.maximum&&!o.maxSize.validationMessage&&(o.maxSize.validationMessage=l,o.maxSize.validationMessage2=n),o.minItems&&o.minItems.minimum&&!o.minItems.validationMessage&&(o.minItems.validationMessage=t),o.maxItems&&o.maxItems.maximum&&!o.maxItems.validationMessage&&(o.maxItems.validationMessage=s);var d=e.stdFormObj(r,o,m);return d.key=m.path,d.type="nwpFileUpload",m.lookup[i.stringify(m.path)]=d,d}};e.defaults.array.unshift(o);var m=function(r,o,m){if("array"===o.type&&"multifile"===o.format){o.pattern&&o.pattern.mimeType&&!o.pattern.validationMessage&&(o.pattern.validationMessage=a),o.maxSize&&o.maxSize.maximum&&!o.maxSize.validationMessage&&(o.maxSize.validationMessage=l,o.maxSize.validationMessage2=n),o.minItems&&o.minItems.minimum&&!o.minItems.validationMessage&&(o.minItems.validationMessage=t),o.maxItems&&o.maxItems.maximum&&!o.maxItems.validationMessage&&(o.maxItems.validationMessage=s);var d=e.stdFormObj(r,o,m);return d.key=m.path,d.type="nwpFileUpload",m.lookup[i.stringify(m.path)]=d,d}};e.defaults.array.unshift(m),r.addMapping("bootstrapDecorator","nwpFileUpload","directives/decorators/bootstrap/nwp-file/nwp-file.html")}]),angular.module("ngSchemaFormFile",["ngFileUpload"]).directive("ngSchemaFile",["Upload","$timeout","$q",function(e,r,i){return{restrict:"A",scope:!0,require:"ngModel",link:function(i,a,l,n){function t(a){a&&!a.$error&&i.url&&(a.upload=e.upload({url:i.url,file:a}),a.upload.then(function(e){r(function(){a.result=e.data})},function(e){e.status>0&&(i.errorMsg=e.status+": "+e.data)}),a.upload.progress(function(e){a.progress=Math.min(100,parseInt(100*e.loaded/e.total))}))}i.url=i.form&&i.form.endpoint,i.isSinglefileUpload=i.form&&i.form.schema&&"singlefile"===i.form.schema.format,i.selectFile=function(e){i.picFile=e},i.selectFiles=function(e){i.picFiles=e},i.uploadFile=function(e){e&&t(e)},i.uploadFiles=function(e){e.length&&angular.forEach(e,function(e){t(e)})},i.validateField=function(){i.uploadForm.file&&i.uploadForm.file.$valid&&i.picFile&&!i.picFile.$error?console.log("singlefile-form is invalid"):i.uploadForm.files&&i.uploadForm.files.$valid&&i.picFiles&&!i.picFiles.$error?console.log("multifile-form is  invalid"):console.log("single- and multifile-form are valid")},i.submit=function(){i.uploadForm.file&&i.uploadForm.file.$valid&&i.picFile&&!i.picFile.$error?i.uploadFile(i.picFile):i.uploadForm.files&&i.uploadForm.files.$valid&&i.picFiles&&!i.picFiles.$error&&i.uploadFiles(i.picFiles)},i.$on("schemaFormValidate",i.validateField),i.$on("schemaFormFileUploadSubmit",i.submit)}}}]),angular.module("schemaForm").run(["$templateCache",function(e){e.put("directives/decorators/bootstrap/nwp-file/nwp-file.html",'<ng-form class="file-upload mb-lg" ng-schema-file ng-model="$$value$$" name="uploadForm">\r\n   <label ng-show="form.title && form.notitle !== true" class="control-label" ng-class="{\'sr-only\': !showTitle()}" for="fileInputButton">\r\n      <strong>{{ form.title }}</strong>\r\n      <i ng-class="{\'text-danger\': uploadForm.file.$error.required}" ng-show="form.required">*{{ \'modules.attribute.fields.required.caption\' | translate }}</i>\r\n   </label>\r\n   <label ng-show="!form.title || form.notitle === true" class="control-label" ng-class="{\'sr-only\': !showTitle()}" for="fileInputButton">\r\n      <strong>{{ isSinglefileUpload ? \'modules.upload.singleFileUpload\' : \'modules.upload.multiFileUpload\' | translate }}</strong>\r\n      <i ng-class="{\'text-danger\': uploadForm.file.$error.required}" ng-show="form.required">*{{ \'modules.attribute.fields.required.caption\' | translate }}</i>\r\n   </label>\r\n   <i class="text-danger errorMsg mb-sm" ng-show="errorMsg">{{errorMsg}}</i>\r\n\r\n   <div ng-show="picFile" class="row mb">\r\n      <div ng-include="\'uploadProcess.html\'"></div>\r\n   </div>\r\n\r\n   <ul ng-show="picFiles && picFiles.length" class="list-group">\r\n      <li class="list-group-item row m0" ng-repeat="picFile in picFiles">\r\n         <div ng-include="\'uploadProcess.html\'"></div>\r\n      </li>\r\n   </ul>\r\n\r\n   <script type=\'text/ng-template\' id="uploadProcess.html">\r\n      <div class="col-sm-4 mb-sm">\r\n         <label title="{{ \'modules.upload.field.preview\' | translate }}" class="text-info">{{ \'modules.upload.field.preview\' | translate }}</label>\r\n         <img ngf-src="picFile" class="img-thumbnail img-responsive">\r\n         <div class="img-placeholder" ng-class="{\'show\': picFile.$invalid && !picFile.blobUrl, \'hide\': !picFile || picFile.blobUrl}">No preview available</div>\r\n      </div>\r\n      <div class="col-sm-4 mb-sm">\r\n         <label title="{{ \'modules.upload.field.filename\' | translate }}" class="text-info">{{ \'modules.upload.field.filename\' | translate }}</label>\r\n         <div class="filename" title="{{ picFile.name }}">{{ picFile.name }}</div>\r\n         <i class="text-danger errorMsg" ng-show="picFile.$error == \'maxSize\'">{{ form.schema[picFile.$error].validationMessage | translate }} <strong>{{picFile.$errorParam}}</strong>. ({{ form.schema[picFile.$error].validationMessage2 | translate }} <strong>{{picFile.size / 1000000|number:1}}MB</strong>)</i>\r\n         <i class="text-danger errorMsg" ng-show="picFile.$error == \'pattern\'">{{ form.schema[picFile.$error].validationMessage | translate }} <strong>{{picFile.$errorParam}}</strong></i>\r\n         <i class="text-danger errorMsg" ng-show="picFile.$error == \'maxItems\'">{{ form.schema[picFile.$error].validationMessage | translate }} <strong>{{picFile.$errorParam}}</strong></i>\r\n         <i class="text-danger errorMsg" ng-show="picFile.$error == \'minItems\'">{{ form.schema[picFile.$error].validationMessage | translate }} <strong>{{picFile.$errorParam}}</strong></i>\r\n         <i class="text-danger errorMsg" ng-show="picFile.$error == \'required\'">*required</i>\r\n      </div>\r\n      <div class="col-sm-4 mb-sm">\r\n         <label title="{{ \'modules.upload.field.progress\' | translate }}" class="text-info">{{ \'modules.upload.field.progress\' | translate }}</label>\r\n         <div class="progress">\r\n           <div class="progress-bar progress-bar-striped" role="progressbar" ng-class="{\'progress-bar-success\': picFile.progress == 100}" ng-style="{width: picFile.progress + \'%\'}">\r\n             {{ picFile.progress }} %\r\n           </div>\r\n         </div>\r\n         <button class="btn btn-primary btn-sm" type="submit" ng-click="uploadFile(picFile)" ng-disabled="!picFile || picFile.$error">{{ "buttons.upload" | translate }}</button>\r\n      </div>\r\n   </script>\r\n\r\n   <div class="well well-sm bg-white">\r\n      <div ng-if="isSinglefileUpload" ng-include="\'singleFileUpload.html\'"></div>\r\n      <div ng-if="!isSinglefileUpload" ng-include="\'multiFileUpload.html\'"></div>\r\n\r\n      <script type=\'text/ng-template\' id="singleFileUpload.html">\r\n         <small class="help-block" ng-show="(hasError() && errorMessage(schemaError())) || form.description" ng-bind-html="(hasError() && errorMessage(schemaError())) || form.description"></small>\r\n         <div ngf-drop="selectFile(picFile)" ngf-select="selectFile(picFile)" type="file" ngf-multiple="false" ng-model="picFile" name="file"\r\n              ng-attr-ngf-pattern="{{form.schema.pattern && form.schema.pattern.mimeType ? form.schema.pattern.mimeType : undefined }}"\r\n              ng-attr-ngf-max-size="{{form.schema.maxSize && form.schema.maxSize.maximum ? form.schema.maxSize.maximum : undefined }}"\r\n              ng-attr-required="{{form.required ? true : undefined }}"\r\n              accept="{{form.schema.pattern && form.schema.pattern.mimeType}}"\r\n              ng-model-options="form.ngModelOptions" ngf-drag-over-class="dragover" class="drop-box dragAndDropDescription">\r\n            <p class="text-center">{{ \'modules.upload.descriptionSinglefile\' | translate }}</p>\r\n         </div>\r\n         <div ngf-no-file-drop>{{ \'modules.upload.dndNotSupported\' | translate}}</div>\r\n\r\n         <button ngf-select="selectFile(picFile)" type="file" ngf-multiple="false" ng-model="picFile" name="file"\r\n              ng-attr-ngf-pattern="{{form.schema.pattern && form.schema.pattern.mimeType ? form.schema.pattern.mimeType : undefined }}"\r\n              ng-attr-ngf-max-size="{{form.schema.maxSize && form.schema.maxSize.maximum ? form.schema.maxSize.maximum : undefined }}"\r\n              ng-attr-required="{{form.required ? true : undefined }}"\r\n              accept="{{form.schema.pattern && form.schema.pattern.mimeType}}"\r\n              ng-model-options="form.ngModelOptions" id="fileInputButton" class="btn btn-primary btn-block {{form.htmlClass}} mt-lg">\r\n            <fa fw="fw" name="upload" class="mr-sm"></fa>\r\n            {{ "buttons.add" | translate }}\r\n         </button>\r\n      </script>\r\n      <script type=\'text/ng-template\' id="multiFileUpload.html">\r\n         <small class="help-block" ng-show="(hasError() && errorMessage(schemaError())) || form.description" ng-bind-html="(hasError() && errorMessage(schemaError())) || form.description"></small>\r\n         <div ngf-drop="selectFiles(picFiles)" ngf-select="selectFiles(picFiles)" type="file" ngf-multiple="true" ng-model="picFiles" name="files"\r\n              ng-attr-ngf-pattern="{{form.schema.pattern && form.schema.pattern.mimeType ? form.schema.pattern.mimeType : undefined }}"\r\n              ng-attr-ngf-max-size="{{form.schema.maxSize && form.schema.maxSize.maximum ? form.schema.maxSize.maximum : undefined }}"\r\n              ng-attr-required="{{form.required ? true : undefined }}"\r\n              accept="{{form.schema.pattern && form.schema.pattern.mimeType}}"\r\n              ng-model-options="form.ngModelOptions" ngf-drag-over-class="dragover" class="drop-box dragAndDropDescription">\r\n            <p class="text-center">{{ \'modules.upload.descriptionMultifile\' | translate }}</p>\r\n         </div>\r\n         <div ngf-no-file-drop>{{ \'modules.upload.dndNotSupported\' | translate}}</div>\r\n\r\n         <button ngf-select="selectFiles(picFiles)" type="file" ngf-multiple="true" multiple ng-model="picFiles" name="files"\r\n              accept="{{form.schema.pattern && form.schema.pattern.mimeType}}"\r\n              ng-attr-ngf-pattern="{{form.schema.pattern && form.schema.pattern.mimeType ? form.schema.pattern.mimeType : undefined }}"\r\n              ng-attr-ngf-max-size="{{form.schema.maxSize && form.schema.maxSize.maximum ? form.schema.maxSize.maximum : undefined }}"\r\n              ng-attr-required="{{form.required ? true : undefined }}"\r\n              ng-model-options="form.ngModelOptions" id="fileInputButton" class="btn btn-primary btn-block {{form.htmlClass}} mt-lg">\r\n            <fa fw="fw" name="upload" class="mr-sm"></fa>\r\n            {{ "buttons.add" | translate }}\r\n         </button>\r\n      </script>\r\n   </div>\r\n</ng-form>\r\n')}]);